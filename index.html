<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Speed & Race - Calculadora da Mec√¢nica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            color: white;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header {
            text-align: center;
            padding: 2rem 0;
            background: linear-gradient(135deg, #8B4513 0%, #DAA520 50%, #1a1a1a 100%);
            margin-bottom: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(139, 69, 19, 0.3);
        }
        .header h1 { font-size: 2.5rem; color: #1a1a1a; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 0.5rem; }
        .header .subtitle { color: #1a1a1a; font-size: 1.2rem; font-weight: 600; }

        /* Login Section */
        .login-section {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(6px);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
            border: 1px solid rgba(255, 140, 0, 0.2);
        }
        .login-section h2 { color: #FFD700; margin-bottom: 1.5rem; font-size: 1.8rem; }

        /* Form Inputs */
        .form-group { margin-bottom: 1.5rem; text-align: left; }
        .form-group label { display: block; color: #FF8C00; font-weight: 600; margin-bottom: 0.5rem; }
        .form-group input {
            width: 100%; padding: 12px; border: 2px solid #FF8C00; border-radius: 8px;
            background: rgba(255,255,255,0.04); color: white; font-size: 1rem; transition: all 0.3s ease;
        }
        .form-group input:focus { outline: none; border-color: #FFD700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.15); }
        .form-group input::placeholder { color: rgba(255,255,255,0.6); }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #FF8C00, #FFD700);
            color: #1a1a1a; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 140, 0, 0.4); }
        .btn-secondary {
            background: transparent; color: #FF8C00; border: 2px solid #FF8C00; padding: 10px 18px; border-radius: 8px;
            cursor: pointer; font-size: 1rem; transition: all 0.3s ease;
        }
        .btn-secondary:hover { background: #FF8C00; color: white; }

        .btn-danger {
            background: #ff4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; 
            cursor: pointer; font-size: 12px; transition: all 0.3s ease;
        }
        .btn-danger:hover { background: #cc3333; }

        /* Main App */
        .main-app { display: none; }
        .main-app.show { display: block; }

        .user-bar {
            background: rgba(255, 140, 0, 0.08);
            padding: 1rem; border-radius: 10px; margin-bottom: 1.5rem; display:flex; justify-content:space-between; align-items:center;
        }
        .user-info { color: #FFD700; font-weight: 600; }

        /* Calculator Grid */
        .calculator-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem; margin-bottom: 2rem;
        }
        .calc-card {
            background: rgba(255,255,255,0.04); backdrop-filter: blur(6px);
            border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255,140,0,0.15); transition: all 0.3s ease;
        }
        .calc-card:hover { transform: translateY(-5px); border-color: #FFD700; box-shadow: 0 15px 30px rgba(255,140,0,0.12); }
        .calc-card h3 { color: #FFD700; margin-bottom: 1rem; font-size: 1.3rem; display:flex; align-items:center; gap:0.5rem; }
        .calc-input { width:100%; padding:10px; border:1px solid #FF8C00; border-radius:5px; background: rgba(0,0,0,0.25); color:white; margin-bottom:1rem; }

        .calc-result { background: rgba(255,215,0,0.08); padding: 12px; border-radius:8px; border-left:4px solid #FFD700; margin-top: .5rem; }
        .calc-result h4 { color:#FFD700; margin-bottom:.5rem; }
        .price { font-size:1.2rem; font-weight:700; color:#FF8C00; }

        /* History Section */
        .history-section { background: rgba(255,255,255,0.04); backdrop-filter: blur(6px); border-radius: 12px; padding:1rem; border: 1px solid rgba(255,140,0,0.12); }
        .history-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
        .history-item { background: rgba(0,0,0,0.25); padding: 0.8rem; border-radius:8px; margin-bottom:0.6rem; border-left:3px solid #FF8C00; }
        .small { color: rgba(255,255,255,0.7); font-size: 0.9rem; }

        /* Responsive */
        @media (max-width: 768px) {
            .calculator-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
            .user-bar { flex-direction: column; gap: 1rem; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèÅ SPORT RACE</h1>
            <div class="subtitle">Sistema de Calculadora da Mec√¢nica</div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="login-section">
            <h2>üîß Acesso ao Sistema</h2>
            <div class="form-group">
                <label>Nome do Mec√¢nico:</label>
                <input type="text" id="mechanicName" placeholder="Digite seu nome">
            </div>
            <div class="form-group">
                <label>Senha:</label>
                <input type="password" id="mechanicPassword" placeholder="Digite sua senha">
            </div>
            <button class="btn" id="btnLogin">ENTRAR NO SISTEMA</button>
            <p style="margin-top: 1rem; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                üí° Primeira vez? Digite qualquer nome e senha para criar sua conta!
            </p>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="main-app">
            <!-- User Bar -->
            <div class="user-bar">
                <div class="user-info">
                    üë®‚Äçüîß Mec√¢nico: <span id="loggedMechanic"></span>
                </div>
                <div style="display:flex; gap: .5rem;">
                    <button class="btn-secondary" id="btnClearInputs">LIMPAR</button>
                    <button class="btn-secondary" id="btnLogout">SAIR</button>
                </div>
            </div>

            <!-- Calculator Grid -->
            <div class="calculator-grid">
                <!-- Margem de Lucro -->
                <div class="calc-card">
                    <h3>üí∞ Margem de Lucro</h3>
                    <input type="number" class="calc-input" id="baseValue" placeholder="Valor base (R$)" oninput="calculateMargins()">
                    <div class="calc-result">
                        <h4>Cliente Normal (+30%)</h4>
                        <div class="price" id="normalPrice">R$ 0,00</div>
                    </div>
                    <div class="calc-result" style="margin-top:8px;">
                        <h4>Cliente Parceiro (+20%)</h4>
                        <div class="price" id="partnerPrice">R$ 0,00</div>
                    </div>
                    <div style="margin-top:10px; display:flex; gap:8px;">
                        <button class="btn" onclick="addToHistory('margem_normal')">Adicionar Normal</button>
                        <button class="btn" onclick="addToHistory('margem_parceiro')">Adicionar Parceiro</button>
                    </div>
                </div>

                <!-- Kit de Reparo -->
                <div class="calc-card">
                    <h3>üîß Kit de Reparo</h3>
                    <input type="number" class="calc-input" id="repairKits" placeholder="Quantidade de kits" oninput="calculateRepairKits()">
                    <div class="calc-result">
                        <h4>Total (R$ 3.500 por kit)</h4>
                        <div class="price" id="repairTotal">R$ 0,00</div>
                    </div>
                    <button class="btn" onclick="addToHistory('kit')">Adicionar ao Hist√≥rico</button>
                </div>

                <!-- Pneus -->
                <div class="calc-card">
                    <h3>üõû Pneus</h3>
                    <input type="number" class="calc-input" id="tires" placeholder="Quantidade de pneus" oninput="calculateTires()">
                    <div class="calc-result">
                        <h4>Total (R$ 800 por pneu)</h4>
                        <div class="price" id="tiresTotal">R$ 0,00</div>
                    </div>
                    <button class="btn" onclick="addToHistory('pneu')">Adicionar ao Hist√≥rico</button>
                </div>

                <!-- Chave de Grifo -->
                <div class="calc-card">
                    <h3>üîß Chave de Grifo</h3>
                    <input type="number" class="calc-input" id="wrenches" placeholder="Quantidade de chaves" oninput="calculateWrenches()">
                    <div class="calc-result">
                        <h4>Total (R$ 1.000 por chave)</h4>
                        <div class="price" id="wrenchesTotal">R$ 0,00</div>
                    </div>
                    <button class="btn" onclick="addToHistory('chave')">Adicionar ao Hist√≥rico</button>
                </div>
            </div>

            <!-- History Section -->
            <div class="history-section">
                <div class="history-header">
                    <h3 style="color:#FFD700;">üìú Hist√≥rico de Servi√ßos</h3>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-secondary" onclick="clearHistory()">Limpar Hist√≥rico</button>
                        <button class="btn" onclick="generatePDF()">Gerar Relat√≥rio</button>
                    </div>
                </div>
                <div id="historyList">
                    <!-- Conte√∫do do hist√≥rico ser√° inserido aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Estado global ---
        let currentMechanic = '';
        let serviceHistory = [];

        // --- Inicializa√ß√£o ---
        window.addEventListener('DOMContentLoaded', () => {
            // Bot√µes
            document.getElementById('btnLogin').addEventListener('click', login);
            document.getElementById('btnLogout').addEventListener('click', logout);
            document.getElementById('btnClearInputs').addEventListener('click', clearAllInputs);

            // Carregar hist√≥rico do localStorage
            loadHistoryFromStorage();
            loadHistory();
        });

        // --- UI e Login ---
        function login() {
            const name = document.getElementById('mechanicName').value.trim();
            const password = document.getElementById('mechanicPassword').value.trim();

            if (name && password) {
                currentMechanic = name;
                document.getElementById('loggedMechanic').textContent = name;
                showMainApp();
                clearLoginInputs();
            } else {
                alert('Por favor, preencha todos os campos!');
            }
        }

        function logout() {
            if (!confirm('Deseja realmente sair?')) return;
            currentMechanic = '';
            document.getElementById('loggedMechanic').textContent = '';
            showLogin();
        }

        function showMainApp() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        function clearLoginInputs() {
            document.getElementById('mechanicName').value = '';
            document.getElementById('mechanicPassword').value = '';
        }

        // --- Formata√ß√£o e c√°lculos ---
        function formatMoney(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function calculateMargins() {
            const baseValue = parseFloat(document.getElementById('baseValue').value) || 0;
            const normalPrice = baseValue * 1.3;
            const partnerPrice = baseValue * 1.2;
            document.getElementById('normalPrice').textContent = formatMoney(normalPrice);
            document.getElementById('partnerPrice').textContent = formatMoney(partnerPrice);
        }

        function calculateRepairKits() {
            const kits = parseInt(document.getElementById('repairKits').value) || 0;
            const total = kits * 3500;
            document.getElementById('repairTotal').textContent = formatMoney(total);
        }

        function calculateTires() {
            const tires = parseInt(document.getElementById('tires').value) || 0;
            const total = tires * 800;
            document.getElementById('tiresTotal').textContent = formatMoney(total);
        }

        function calculateWrenches() {
            const wrenches = parseInt(document.getElementById('wrenches').value) || 0;
            const total = wrenches * 1000;
            document.getElementById('wrenchesTotal').textContent = formatMoney(total);
        }

        // --- Hist√≥rico ---
        function loadHistoryFromStorage() {
            try {
                const stored = localStorage.getItem('mechanicHistory');
                serviceHistory = stored ? JSON.parse(stored) : [];
            } catch (e) {
                console.error('Erro ao carregar hist√≥rico:', e);
                serviceHistory = [];
            }
        }

        function saveHistoryToStorage() {
            try {
                localStorage.setItem('mechanicHistory', JSON.stringify(serviceHistory));
            } catch (e) {
                console.error('Erro ao salvar hist√≥rico:', e);
            }
        }

        function addToHistory(type) {
            if (!currentMechanic) {
                alert('Voc√™ precisa entrar no sistema para adicionar ao hist√≥rico.');
                return;
            }

            const now = new Date().toLocaleString('pt-BR');
            let entry = null;

            switch(type) {
                case 'margem_normal': {
                    const baseValue = parseFloat(document.getElementById('baseValue').value) || 0;
                    if (baseValue === 0) { alert('Digite um valor base primeiro!'); return; }
                    const value = baseValue * 1.3;
                    entry = { description: 'Margem - Cliente Normal', value, mechanic: currentMechanic, date: now };
                    break;
                }
                case 'margem_parceiro': {
                    const baseValue = parseFloat(document.getElementById('baseValue').value) || 0;
                    if (baseValue === 0) { alert('Digite um valor base primeiro!'); return; }
                    const value = baseValue * 1.2;
                    entry = { description: 'Margem - Cliente Parceiro', value, mechanic: currentMechanic, date: now };
                    break;
                }
                case 'kit': {
                    const kits = parseInt(document.getElementById('repairKits').value) || 0;
                    if (kits === 0) { alert('Digite a quantidade de kits primeiro!'); return; }
                    const value = kits * 3500;
                    entry = { description: `${kits} x Kit(s) de Reparo`, value, mechanic: currentMechanic, date: now };
                    break;
                }
                case 'pneu': {
                    const tires = parseInt(document.getElementById('tires').value) || 0;
                    if (tires === 0) { alert('Digite a quantidade de pneus primeiro!'); return; }
                    const value = tires * 800;
                    entry = { description: `${tires} x Pneu(s)`, value, mechanic: currentMechanic, date: now };
                    break;
                }
                case 'chave': {
                    const wrenches = parseInt(document.getElementById('wrenches').value) || 0;
                    if (wrenches === 0) { alert('Digite a quantidade de chaves primeiro!'); return; }
                    const value = wrenches * 1000;
                    entry = { description: `${wrenches} x Chave(s) de Grifo`, value, mechanic: currentMechanic, date: now };
                    break;
                }
                default:
                    alert('Tipo inv√°lido');
                    return;
            }

            serviceHistory.push(entry);
            saveHistoryToStorage();
            loadHistory();
            alert('‚úÖ Registrado no hist√≥rico!');
        }

        function loadHistory() {
            const historyList = document.getElementById('historyList');

            if (!historyList) return;

            if (!serviceHistory || serviceHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align:center; color: rgba(255,255,255,0.6);">Nenhum servi√ßo registrado ainda</p>';
                return;
            }

            let html = '';
            let totalValue = 0;

            serviceHistory.forEach((service, index) => {
                totalValue += Number(service.value) || 0;
                html += `
                    <div class="history-item">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <strong style="color:#FFD700;">${escapeHtml(service.description)}</strong>
                                <div class="small">üë®‚Äçüîß ${escapeHtml(service.mechanic)} ‚Ä¢ ${escapeHtml(service.date)}</div>
                            </div>
                            <div style="text-align:right;">
                                <div class="price" style="font-size:1.1rem;">${formatMoney(service.value)}</div>
                                <div style="margin-top:6px;">
                                    <button class="btn-danger" onclick="removeFromHistory(${index})">Remover</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                <div style="text-align:center; margin-top:1rem; padding: 1rem; background: rgba(255,215,0,0.08); border-radius:8px;">
                    <h3 style="color:#FFD700; margin-bottom:6px;">üí∞ Total Geral: ${formatMoney(totalValue)}</h3>
                    <div class="small">Total de Servi√ßos: ${serviceHistory.length}</div>
                </div>
            `;

            historyList.innerHTML = html;
        }

        function removeFromHistory(index) {
            if (!confirm('Tem certeza que deseja remover este servi√ßo?')) return;
            
            // Verificar se o √≠ndice √© v√°lido
            if (index >= 0 && index < serviceHistory.length) {
                serviceHistory.splice(index, 1);
                saveHistoryToStorage();
                loadHistory();
                alert('‚úÖ Servi√ßo removido do hist√≥rico!');
            } else {
                alert('‚ùå Erro ao remover servi√ßo. Tente recarregar a p√°gina.');
            }
        }

        function clearHistory() {
            if (!confirm('Tem certeza que deseja limpar todo o hist√≥rico? Essa a√ß√£o √© irrevers√≠vel.')) return;
            
            serviceHistory = [];
            saveHistoryToStorage();
            loadHistory();
            alert('‚úÖ Hist√≥rico limpo com sucesso!');
        }

        function generatePDF() {
            if (!serviceHistory || serviceHistory.length === 0) {
                alert('N√£o h√° hist√≥rico para gerar relat√≥rio!');
                return;
            }

            let content = `SPORT RACE - RELAT√ìRIO DE SERVI√áOS\n\nMec√¢nico: ${currentMechanic || '‚Äî'}\nData do Relat√≥rio: ${new Date().toLocaleString('pt-BR')}\n\nHIST√ìRICO DE SERVI√áOS:\n\n`;
            let total = 0;

            serviceHistory.forEach(s => {
                total += Number(s.value) || 0;
                content += `üìÖ ${s.date}\nüîß ${s.description}\nüí∞ ${formatMoney(s.value)}\nüë®‚Äçüîß ${s.mechanic}\n\n`;
            });

            content += `=====================================\nüí∞ TOTAL GERAL: ${formatMoney(total)}\nüìä Total de Servi√ßos: ${serviceHistory.length}\n`;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Sport_Race_Relatorio_${new Date().toLocaleDateString('pt-BR').replace(/\//g,'-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Utilit√°rios ---
        function clearAllInputs() {
            // Limpar todos os campos de entrada
            document.getElementById('baseValue').value = '';
            document.getElementById('repairKits').value = '';
            document.getElementById('tires').value = '';
            document.getElementById('wrenches').value = '';
            
            // Recalcular todos os valores para zero
            calculateMargins();
            calculateRepairKits();
            calculateTires();
            calculateWrenches();
            
            alert('‚úÖ Todos os campos foram limpos!');
        }

        function escapeHtml(str) {
            if (!str && str !== 0) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }
    </script>
</body>
</html>